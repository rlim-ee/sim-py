/* ===============================
   styles.css — Dashboard Shiny (light/dark)
   Version condensée (classes réellement utilisées)
================================= */

/* ---------- THEME VARS ---------- */
:root{
  --bg:#f7f7fb; --card:#ffffff; --text:#0B162C; --muted:#6b7280;
  --brand:#1F6FEB; --brand-2:#2EA043; --accent:#F97316;
  --ring:rgba(31,111,235,.18); --border:rgba(2,6,23,.10);
  --panel-bg:var(--card); --panel-fg:var(--text);
  --panel-br:14px; --panel-sh:0 10px 28px rgba(18,38,63,.08);
  --map-h:560px;
}
html.dark, html.theme-dark{
  --bg:#0D1117; --card:#161B22; --text:#F8FAFC; --muted:#CBD5E1;
  --brand:#58A6FF; --brand-2:#2EA043; --accent:#FF7B72;
  --ring:rgba(88,166,255,.25); --border:rgba(148,163,184,.18);
  --panel-bg:#0f172a; --panel-fg:#e5e7eb; --panel-sh:0 12px 34px rgba(0,0,0,.45);
}
@media (min-width:1600px){ :root{ --map-h:600px } }
@media (max-width:992px){ :root{ --map-h:460px } }

/* ---------- BASE ---------- */
html,body{height:100%}
body{
  margin:0; background:var(--bg); color:var(--text);
  font-family:'Poppins', system-ui, -apple-system, Segoe UI, Roboto, sans-serif !important;
}
.container-app{max-width:1200px;margin:18px auto 40px;padding:0 16px}
.row{display:flex;flex-wrap:wrap}
.row.gap-4>.col{flex:1 1 0;min-width:260px;margin-right:1rem}
.row.gap-4>.col:last-child{margin-right:0}
.row-eq>.col{display:flex;flex-direction:column}

/* ---------- TOPBAR ---------- */
.topbar{
  display:flex;align-items:center;justify-content:space-between;gap:.75rem;
  padding:.75rem 1rem;border-bottom:1px solid var(--border);
  position:sticky;top:0;background:color-mix(in oklab,var(--bg) 94%,transparent);
  backdrop-filter:blur(6px);z-index:20;
}
.brandbox{display:flex;align-items:center;gap:.6rem}
.logo{height:44px;width:auto;object-fit:contain}
.brand{font-weight:700;letter-spacing:.2px}

/* ---------- TABS ---------- */
.nav-tabs{border:0 !important;margin-bottom:14px}
.nav-tabs .nav-link{color:var(--text);border:0;margin-right:8px;border-radius:10px;background:transparent}
.nav-tabs .nav-link:hover{background:rgba(0,0,0,.05)}
html.dark .nav-tabs .nav-link:hover{background:#1b2836}
html:not(.dark):not(.theme-dark) .nav-tabs .nav-link.active{
  background:#E9F2FF;color:#0B162C !important;border:1px solid rgba(31,111,235,.35);
  box-shadow:0 6px 18px rgba(31,111,235,.18);
}
html.dark .nav-tabs .nav-link.active{
  background:var(--brand);color:#fff !important;border-color:transparent;box-shadow:0 6px 18px var(--ring);
}

/* ---------- PANELS ---------- */
.panel{
  background:var(--panel-bg);color:var(--panel-fg);
  border-radius:var(--panel-br);box-shadow:var(--panel-sh);padding:14px;
}
.panel-head{display:flex;align-items:center;gap:.6rem;margin-bottom:.6rem;font-weight:700}
.panel-title{margin:0}
.panel-body{padding:6px 2px}
.panel-foot{opacity:.85;margin-top:.5rem;color:var(--muted)}
.row-eq{align-items:stretch}

/* ---------- CARTE EUROPE ---------- */
.map-wrap{
  height:var(--map-h);min-height:var(--map-h);width:100%;
  position:relative;overflow:hidden;
}
.map-wrap iframe,
.map-wrap .folium-map,
.map-wrap .leaflet-container,
.map-wrap > *{height:100% !important;width:100% !important}
.map-wrap [style*="padding-bottom"]{padding-bottom:0 !important;height:100% !important}

/* Leaflet */
.leaflet-container{background:var(--panel-bg);border-radius:10px}
.leaflet-bar a, .leaflet-control-layers-toggle{background:var(--card);color:var(--text)}
.leaflet-control-attribution{background:color-mix(in oklab, var(--card) 85%, transparent);color:var(--muted)}
.leaflet-control-scale-line{background:var(--card);color:var(--text);border-color:var(--border)}

/* ---------- CARDS ---------- */
.card{
  background:var(--card);border-radius:14px;padding:16px 18px;
  box-shadow:var(--panel-sh);border:1px solid var(--border);margin-bottom:18px;color:var(--text);
}
.card .card-title{font-weight:900;font-size:clamp(20px,2.2vw,26px);line-height:1.15;margin:0 0 10px}

/* ---------- SIDEBAR ---------- */
.sidebar{
  background:var(--card);border-radius:12px;padding:16px;
  box-shadow:0 8px 24px rgba(18,38,63,.07);border:1px solid var(--border);color:var(--text);
}
.sidebar h4{font-weight:700;font-size:20px;margin-bottom:10px}
.form-label{font-weight:600;color:var(--muted)}
.form-select:focus,.form-control:focus{border-color:var(--brand);box-shadow:0 0 0 .25rem var(--ring)}
.form-range::-webkit-slider-thumb{background:var(--brand)}
html.dark .sidebar{
  background: radial-gradient(120% 120% at 0% 0%, #0f1a2a 0%, #151c27 45%, #0d1117 100%);
  border:1px solid #2a3a4d; box-shadow:0 12px 30px rgba(0,0,0,.35); color:#f1f5f9 !important;
}
html.dark .sidebar .form-control, html.dark .sidebar .form-select{background:#0b1220;color:#f1f5f9;border-color:#2a3a4d}
html.dark .sidebar .form-control:focus, html.dark .sidebar .form-select:focus{border-color:#58A6FF;box-shadow:0 0 0 .2rem rgba(88,166,255,.25)}

/* ---------- KPI ---------- */
.kpi-card{
  background:var(--panel-bg);color:var(--panel-fg);border-radius:var(--panel-br);
  box-shadow:var(--panel-sh);padding:18px;display:flex;flex-direction:column;
}
.kpi-title{font-weight:700;margin-bottom:.1rem}
.kpi-value{font-weight:800;margin:.2rem 0 .6rem 0}
.kpi-icon{width:38px;height:38px;border-radius:999px;display:flex;align-items:center;justify-content:center;margin-bottom:.35rem}
.accent-bolt .kpi-icon{background:#fff7ed;color:#ea580c}
.accent-rank .kpi-icon{background:#eff6ff;color:#1d4ed8}
.accent-geo  .kpi-icon{background:#ecfeff;color:#0891b2}
.kpi-card.neutral .kpi-icon{background:transparent;border:1px solid var(--border)}
.kpi-sub{color:var(--muted);margin-top:.35rem;display:block}

/* Grille KPI équivalents */
.kpi-eq{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));column-gap:22px;row-gap:18px}
:root{--kpi-h-sm:150px;--kpi-h-lg:170px}
.kpi-eq .kpi-card{height:var(--kpi-h-sm);min-height:var(--kpi-h-sm)}
@media (min-width:992px){.kpi-eq .kpi-card{height:var(--kpi-h-lg);min-height:var(--kpi-h-lg)}}

/* ---------- METRICS ---------- */
.metric{
  display:flex;flex-direction:column;gap:8px;background:var(--card);color:var(--text);
  border-left:6px solid var(--brand);border:1px solid var(--border);border-radius:16px;
  padding:18px 20px;min-height:150px;box-shadow:0 10px 28px rgba(18,38,63,.10);
}
.metric h4{font-size:13px;margin:0;color:var(--muted);font-weight:900;text-transform:uppercase;letter-spacing:.4px}
.metric .value{font-size:clamp(22px,2.2vw,32px);font-weight:900}

/* ---------- DROPCARDS ---------- */
.dropcard{
  background:var(--card);color:var(--text);border-radius:14px;border:1px solid var(--border);
  box-shadow:var(--panel-sh);margin:14px 0 18px;overflow:hidden;
}
.dropcard>summary{
  cursor:pointer;list-style:none;display:flex;align-items:center;gap:.6rem;
  padding:14px 16px;font-weight:800;color:var(--text);
}
.dropcard>summary::-webkit-details-marker{display:none}
.dropcard>summary::before{
  content:"";width:10px;height:10px;border-right:2px solid var(--muted);border-bottom:2px solid var(--muted);
  transform:rotate(-45deg);transition:transform .18s ease;margin-right:.2rem;
}
.dropcard[open]>summary::before{transform:rotate(45deg)}
.dropcard .dropbody{padding:12px 16px 14px;border-top:1px solid var(--border)}
html.dark .dropcard{background:var(--panel-bg);color:var(--panel-fg)}


/* === PLOTLY responsive partout (panel + card + générique) === */
.panel-body .js-plotly-plot,
.panel-body .plotly-graph-div,
.card .js-plotly-plot,
.card .plotly-graph-div,
.shiny-output-widget .js-plotly-plot,
.shiny-output-widget .plotly-graph-div {
  width: 100% !important;
  max-width: 100% !important;
}
.js-plotly-plot .plotly .modebar{background:transparent;border:0}
html.dark .js-plotly-plot .plotly text{fill:#e5e7eb !important}

/* éviter qu'un wrapper impose une largeur fixe inline */
.shiny-output-widget,
.plotly, .plotly-html-widget, .plotly-graph-div {
  width: 100% !important;
  max-width: 100% !important;
  display: block;
}


/* ---------- FOOTER ---------- */
.app-footer{border-top:1px solid var(--border);background:color-mix(in oklab,var(--bg) 96%,transparent);margin-top:26px}
.footer-inner{max-width:1200px;margin:0 auto;padding:16px 20px;display:flex;align-items:center;justify-content:space-between;gap:16px;flex-wrap:wrap}
.footer-logos{display:flex;align-items:center;gap:14px;min-height:44px}
.footer-logos img{height:40px;width:auto;object-fit:contain}
.partners--dark{display:none}
html.dark .partners--light{display:none}
html.dark .partners--dark{display:inline-block}
.footer-credits{color:var(--muted);font-size:14px;text-align:right}
.footer-credits strong{color:var(--text)}
.footer-text{color:var(--muted);font-size:14px;text-align:center}

/* ---------- UTILITIES ---------- */
.mb-2{margin-bottom:8px}.mb-3{margin-bottom:12px}.mb-4{margin-bottom:18px}
.mt-2{margin-top:8px}.mt-3{margin-top:12px}.mt-4{margin-top:18px}

/* ---------- Hide Shiny toasts ---------- */
#shiny-notification-panel,.shiny-notification,.shiny-notification-container,
.shiny-toast,.shiny-toast-container,.bslib-toast,.bslib-toast-container,
.toast-container,.toast{display:none !important}
